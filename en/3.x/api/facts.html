<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="docsearch:version" content="3.x" />
  <meta name="docsearch:language" content="en" />
  
    <title>Writing Facts &#8212; pyinfra  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5349f25f" />
    <link rel="stylesheet" type="text/css" href="../_static/guzzle.css?v=fb44425a" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/logo_small.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Writing Connectors" href="connectors.html" />
    <link rel="prev" title="Writing Operations" href="operations.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="connectors.html" title="Writing Connectors"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="operations.html" title="Writing Operations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Writing Facts</a></li> 
      </ul>
    </div>
  <div class="container-wrapper">
    <header>
      <nav>
        <a target="_blank" href="https://pyinfra.com">pyinfra.com<span class="glyphicon glyphicon glyphicon-share" aria-hidden="true"></span></a>
        <a target="_blank" href="https://github.com/Fizzadar/pyinfra">GitHub<span class="glyphicon glyphicon glyphicon-share" aria-hidden="true"></span></a>
      </nav>

      <div id="header-sidebar">
        <a href="../index.html" class="text-logo">
            <img src="../_static/logo_small.png" />
            pyinfra <small>3.x</small>
        </a>
        
<form id="main-search" class="form-inline" action="../search.html" method="GET" role="form">
  <div id="docsearch">
    <input id="search-input" name="q" type="text" class="form-control" placeholder="Search...">
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </div>
</form>
      </div>

      <div id="mobile-toggle">
        <a id="toggle-menu" href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
        <a href="../index.html" class="text-logo">
            <img src="../_static/logo_small.png" />
        </a>
      </div>
    </header>
    <div id="left-column">
      <div class="sphinxsidebar">
        <div class="sidebar-block">
    <div class="sidebar-toc">
        <p class="caption" role="heading"><span class="caption-text">Using pyinfra</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using-operations.html">Using Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inventory-data.html">Inventory &amp; Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arguments.html">Global Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Using the CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deploy Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../operations.html">Operations Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../facts.html">Facts Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connectors.html">Connectors Index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How pyinfra Works</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../deploy-process.html">How pyinfra Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploys.html">Packaging Deploys</a></li>
<li class="toctree-l1"><a class="reference internal" href="operations.html">Writing Operations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing Facts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#importing-using-facts">Importing &amp; Using Facts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-getting-swap-status">Example: getting swap status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-getting-the-list-of-files-in-a-directory">Example: getting the list of files in a directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-getting-any-output-from-a-command">Example: getting any output from a command</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="connectors.html">Writing Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Using the API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Help &amp; Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compatibility.html">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Reference</a></li>
</ul>

    </div>
</div>
      </div>
    </div>
    
      <div id="right-column">
        
        <div class="document clearer body" role="main">
          
  <section id="writing-facts">
<h1>Writing Facts<a class="headerlink" href="#writing-facts" title="Link to this heading">¶</a></h1>
<p><a class="reference internal" href="../facts.html"><span class="doc std std-doc">Facts</span></a> are written as Python classes. They provide a <code class="docutils literal notranslate"><span class="pre">command</span></code> (as either a string or method)
and a <code class="docutils literal notranslate"><span class="pre">process</span></code> function. The command is executed on the target host and the output
passed (as a <code class="docutils literal notranslate"><span class="pre">list</span></code> of lines) to the <code class="docutils literal notranslate"><span class="pre">process</span></code> handler to generate fact data. Facts can output anything, normally a <code class="docutils literal notranslate"><span class="pre">list</span></code> or <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p>
<p>Fact classes may provide a <code class="docutils literal notranslate"><span class="pre">default</span></code> function that takes no arguments (except <code class="docutils literal notranslate"><span class="pre">self</span></code>). The return value of this function is used if an error
occurs during fact collection. Additionally, a <code class="docutils literal notranslate"><span class="pre">requires_command</span></code> variable can be set on the fact that specifies a command that must be available
on the host to collect the fact. If this command is not present on the host, the fact will be set to the default, or empty if no <code class="docutils literal notranslate"><span class="pre">default</span></code> function
is available.</p>
<section id="importing-using-facts">
<h2>Importing &amp; Using Facts<a class="headerlink" href="#importing-using-facts" title="Link to this heading">¶</a></h2>
<p>Like operations, facts are imported from Python modules and executed by calling <code class="docutils literal notranslate"><span class="pre">Host.get_fact</span></code>. For example:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyinfra</span><span class="w"> </span><span class="kn">import</span> <span class="n">host</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyinfra.facts.server</span><span class="w"> </span><span class="kn">import</span> <span class="n">Which</span>

<span class="n">host</span><span class="o">.</span><span class="n">get_fact</span><span class="p">(</span><span class="n">Which</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s1">&#39;htop&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="example-getting-swap-status">
<h2>Example: getting swap status<a class="headerlink" href="#example-getting-swap-status" title="Link to this heading">¶</a></h2>
<p>This fact returns a boolean indicating whether swap is enabled. For this fact the <code class="docutils literal notranslate"><span class="pre">command</span></code> is declared as a class attribute.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w">  </span><span class="nn">pyinfra.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">FactBase</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SwapEnabled</span><span class="p">(</span><span class="n">FactBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a boolean indicating whether swap is enabled.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">command</span> <span class="o">=</span> <span class="s1">&#39;swapon --show&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># we have one+ lines</span>
</pre></div>
</div>
<p>This fact could then be used like so:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">is_swap_enabled</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">get_fact</span><span class="p">(</span><span class="n">SwapEnabled</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="example-getting-the-list-of-files-in-a-directory">
<h2>Example: getting the list of files in a directory<a class="headerlink" href="#example-getting-the-list-of-files-in-a-directory" title="Link to this heading">¶</a></h2>
<p>This fact returns a list of files found in a given directory. For this fact the <code class="docutils literal notranslate"><span class="pre">command</span></code> is declared as a class method, indicating the fact takes arguments.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyinfra.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">FactBase</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FindFiles</span><span class="p">(</span><span class="n">FactBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a list of files from a start point, recursively using find.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="c1"># Find files in the given location</span>
        <span class="k">return</span> <span class="s1">&#39;find </span><span class="si">{0}</span><span class="s1"> -type f&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">output</span>  <span class="c1"># return the list of lines (files) as-is</span>
</pre></div>
</div>
<p>This fact could then be used like so:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">list_of_files</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">get_fact</span><span class="p">(</span><span class="n">FindFiles</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/somewhere&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="example-getting-any-output-from-a-command">
<h2>Example: getting any output from a command<a class="headerlink" href="#example-getting-any-output-from-a-command" title="Link to this heading">¶</a></h2>
<p>This fact returns the raw output of any command. For this fact the <code class="docutils literal notranslate"><span class="pre">command</span></code> is declared as a class method, indicating the fact takes arguments.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyinfra.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">FactBase</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RawCommandOutput</span><span class="p">(</span><span class="n">FactBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the raw output of a command.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">command</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>  <span class="c1"># re-join and return the output lines</span>
</pre></div>
</div>
<p>This fact could then be used like so:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">command_output</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">get_fact</span><span class="p">(</span><span class="n">RawCommandOutput</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s1">&#39;execute this command&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


        </div>
          
  <nav class="footer-relations">
    <ul class="pager">
      
        <li class="previous"><a href="operations.html">
          <span aria-hidden="true">&larr;</span> Writing Operations
        </a></li>
      
        <li class="next"><a href="connectors.html">
          Writing Connectors <span aria-hidden="true">&rarr;</span>
        </a></li>
      
    </ul>
  </nav>
    <div class="clearer"></div>
  
      </div>
      <div class="clearfix"></div>
  </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="connectors.html" title="Writing Connectors"
             >next</a> |</li>
        <li class="right" >
          <a href="operations.html" title="Writing Operations"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Writing Facts</a></li> 
      </ul>
    </div>
<script type="text/javascript" src="../_static/js/jquery.min.js"></script>
<script type="text/javascript" src="../_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $("a#toggle-menu").click(function () {
    $("#left-column").slideToggle(100);
  });

  var currentIndexItem = document.querySelector('ul.current ul.current li.current');
  if (currentIndexItem) {
    currentIndexItem.scrollIntoView({'block': 'center'});
  }
</script>
  <div class="footer">
  </div>


  <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
        apiKey: '25a25b5f5310f306641f9ce07dcb06eb',
        appId: 'XXGX6EX4KA',
        indexName: 'pyinfra',
        container: '#docsearch',
        searchParameters: {
          facetFilters: ["version:3.x", "lang:en"],
        },
        debug: false,
    });
  </script>



  
    <script async defer data-domain="docs.pyinfra.com" src="https://stats.oxygem.com/js/index.js"></script>
  

  </body>
</html>