<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />
  <meta name="docsearch:version" content="latest" />
  <meta name="docsearch:language" content="en" />
  
    <title>Files Operations &#8212; pyinfra  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b20cc3f5" />
    <link rel="stylesheet" type="text/css" href="../_static/guzzle.css?v=df830e76" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/logo_small.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Flatpak Operations" href="flatpak.html" />
    <link rel="prev" title="Docker Operations" href="docker.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="flatpak.html" title="Flatpak Operations"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="docker.html" title="Docker Operations"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../operations.html" accesskey="U">Operations Index</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Files Operations</a></li> 
      </ul>
    </div>
  <div class="container-wrapper">
    <header>
      <nav>
        <a target="_blank" href="https://pyinfra.com">pyinfra.com<span class="glyphicon glyphicon glyphicon-share" aria-hidden="true"></span></a>
        <a target="_blank" href="https://github.com/Fizzadar/pyinfra">GitHub<span class="glyphicon glyphicon glyphicon-share" aria-hidden="true"></span></a>
      </nav>

      <div id="header-sidebar">
        <a href="../index.html" class="text-logo">
            <img src="../_static/logo_small.png" />
            pyinfra <small>latest</small>
        </a>
        
<form id="main-search" class="form-inline" action="../search.html" method="GET" role="form">
  <div id="docsearch">
    <input id="search-input" name="q" type="text" class="form-control" placeholder="Search...">
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </div>
</form>
      </div>

      <div id="mobile-toggle">
        <a id="toggle-menu" href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
        <a href="../index.html" class="text-logo">
            <img src="../_static/logo_small.png" />
        </a>
      </div>
    </header>
    <div id="left-column">
      <div class="sphinxsidebar">
        <div class="sidebar-block">
    <div class="sidebar-toc">
        <p class="caption" role="heading"><span class="caption-text">Using pyinfra</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using-operations.html">Using Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inventory-data.html">Inventory &amp; Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arguments.html">Global Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Using the CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deploy Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../operations.html">Operations Index</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="apk.html">Apk Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="apt.html">Apt Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="brew.html">Brew Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="bsdinit.html">Bsdinit Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="cargo.html">Cargo Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="choco.html">Choco Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="crontab.html">Crontab Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="dnf.html">Dnf Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html">Docker Operations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Files Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#files-block"><code class="code docutils literal notranslate"><span class="pre">files.block</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-directory"><code class="code docutils literal notranslate"><span class="pre">files.directory</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-download"><code class="code docutils literal notranslate"><span class="pre">files.download</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-file"><code class="code docutils literal notranslate"><span class="pre">files.file</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-flags"><code class="code docutils literal notranslate"><span class="pre">files.flags</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-get"><code class="code docutils literal notranslate"><span class="pre">files.get</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-line"><code class="code docutils literal notranslate"><span class="pre">files.line</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-link"><code class="code docutils literal notranslate"><span class="pre">files.link</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-move"><code class="code docutils literal notranslate"><span class="pre">files.move</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-put"><code class="code docutils literal notranslate"><span class="pre">files.put</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-replace"><code class="code docutils literal notranslate"><span class="pre">files.replace</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-rsync"><code class="code docutils literal notranslate"><span class="pre">files.rsync</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-sync"><code class="code docutils literal notranslate"><span class="pre">files.sync</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#files-template"><code class="code docutils literal notranslate"><span class="pre">files.template</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flatpak.html">Flatpak Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="gem.html">Gem Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="git.html">Git Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="iptables.html">Iptables Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="launchd.html">Launchd Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="lxd.html">Lxd Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql.html">Mysql Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="npm.html">Npm Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="openrc.html">Openrc Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="opkg.html">Opkg Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="pacman.html">Pacman Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="pip.html">Pip Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="pipx.html">Pipx Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="pkg.html">Pkg Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="pkgin.html">Pkgin Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgres.html">Postgres Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgresql.html">Postgresql Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="puppet.html">Puppet Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html">Python Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="runit.html">Runit Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="selinux.html">Selinux Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="server.html">Server Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="snap.html">Snap Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="ssh.html">Ssh Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="systemd.html">Systemd Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysvinit.html">Sysvinit Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="upstart.html">Upstart Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="vzctl.html">Vzctl Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="xbps.html">Xbps Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="yum.html">Yum Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="zfs.html">Zfs Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="zypper.html">Zypper Operations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../facts.html">Facts Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connectors.html">Connectors Index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How pyinfra Works</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../deploy-process.html">How pyinfra Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/deploys.html">Packaging Deploys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/operations.html">Writing Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/facts.html">Writing Facts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/connectors.html">Writing Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Using the API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Help &amp; Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compatibility.html">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/reference.html">API Reference</a></li>
</ul>

    </div>
</div>
      </div>
    </div>
    
      <div id="right-column">
        
          
            <div class="admonition important">
                <p class="first admonition-title">Documentation may contain unreleased features!</p>
                <p>You are reading most recent documentation which may not have been released yet. <a href="/en/3.x/operations/files.html"><strong>3.x</strong></a> is the latest release version available.</p>
            </div>
          
        
        <div class="document clearer body" role="main">
          
  <section id="files-operations">
<h1>Files Operations<a class="headerlink" href="#files-operations" title="Link to this heading">¶</a></h1>
<p>The files operations handles filesystem state, file uploads and template generation.</p>
<p>Facts used in these operations: <a class="reference internal" href="../facts/files.html#facts-files-block"><span class="std std-ref">files.Block</span></a>, <a class="reference internal" href="../facts/server.html#facts-server-date"><span class="std std-ref">server.Date</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-directory"><span class="std std-ref">files.Directory</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-file"><span class="std std-ref">files.File</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-findfiles"><span class="std std-ref">files.FindFiles</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-findinfile"><span class="std std-ref">files.FindInFile</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-flags"><span class="std std-ref">files.Flags</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-link"><span class="std std-ref">files.Link</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-md5file"><span class="std std-ref">files.Md5File</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-sha1file"><span class="std std-ref">files.Sha1File</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-sha256file"><span class="std std-ref">files.Sha256File</span></a>, <a class="reference internal" href="../facts/files.html#facts-files-sha384file"><span class="std std-ref">files.Sha384File</span></a>, <a class="reference internal" href="../facts/server.html#facts-server-which"><span class="std std-ref">server.Which</span></a>.</p>
<section id="files-block">
<span id="operations-files-block"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.block</span></code><a class="headerlink" href="#files-block" title="Link to this heading">¶</a></h2>
<p>Ensure content, surrounded by the appropriate markers, is present (or not) in the file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">block</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">escape_regex_characters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">try_prevent_shell_expansion</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">before</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">marker</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">begin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>path</strong>: target remote file</p></li>
<li><p><strong>content</strong>: what should be present in the file (between markers).</p></li>
<li><p><strong>present</strong>: whether the content should be present in the file</p></li>
<li><p><strong>before</strong>: should the content be added before <code class="docutils literal notranslate"><span class="pre">line</span></code> if it doesn’t exist</p></li>
<li><p><strong>after</strong>: should the content be added after <code class="docutils literal notranslate"><span class="pre">line</span></code> if it doesn’t exist</p></li>
<li><p><strong>line</strong>: regex before or after which the content should be added if it doesn’t exist.</p></li>
<li><p><strong>backup</strong>: whether to backup the file (see <code class="docutils literal notranslate"><span class="pre">files.line</span></code>). Default False.</p></li>
<li><p><strong>escape_regex_characters</strong>: whether to escape regex characters from the matching line</p></li>
<li><p><strong>try_prevent_shell_expansion</strong>: tries to prevent shell expanding by values like <cite>$</cite></p></li>
<li><p><strong>marker</strong>: the base string used to mark the text.  Default is <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">{mark}</span> <span class="pre">PYINFRA</span> <span class="pre">BLOCK</span></code></p></li>
<li><p><strong>begin</strong>: the value for <code class="docutils literal notranslate"><span class="pre">{mark}</span></code> in the marker before the content. Default is <code class="docutils literal notranslate"><span class="pre">BEGIN</span></code></p></li>
<li><p><strong>end</strong>: the value for <code class="docutils literal notranslate"><span class="pre">{mark}</span></code> in the marker after the content. Default is <code class="docutils literal notranslate"><span class="pre">END</span></code></p></li>
</ul>
<dl class="simple">
<dt>Content appended if <code class="docutils literal notranslate"><span class="pre">line</span></code> not found in the file</dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">content</span></code> is not in the file but is required (<code class="docutils literal notranslate"><span class="pre">present=True</span></code>) and <code class="docutils literal notranslate"><span class="pre">line</span></code> is not
found in the file, <code class="docutils literal notranslate"><span class="pre">content</span></code> (surrounded by markers) will be appended to the file.  The
file is created if necessary.</p>
</dd>
<dt>Content prepended or appended if <code class="docutils literal notranslate"><span class="pre">line</span></code> not specified</dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">content</span></code> is not in the file but is required and <code class="docutils literal notranslate"><span class="pre">line</span></code> was not provided the content
will either be  prepended to the file (if both <code class="docutils literal notranslate"><span class="pre">before</span></code> and <code class="docutils literal notranslate"><span class="pre">after</span></code>
are <code class="docutils literal notranslate"><span class="pre">True</span></code>) or appended to the file (if both are <code class="docutils literal notranslate"><span class="pre">False</span></code>).</p>
</dd>
</dl>
<p>Removal ignores <code class="docutils literal notranslate"><span class="pre">content</span></code> and <code class="docutils literal notranslate"><span class="pre">line</span></code></p>
<p>Preventing shell expansion works by wrapping the content in ‘`’ before passing to <cite>awk</cite>.
WARNING: This will break if the content contains raw single quotes.</p>
<p><strong>Examples:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># add entry to /etc/host</span>
<span class="n">files</span><span class="o">.</span><span class="n">block</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;add IP address for red server&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/hosts&quot;</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;10.0.0.1 mars-one&quot;</span><span class="p">,</span>
    <span class="n">before</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;.*localhost&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># have two entries in /etc/host</span>
<span class="n">files</span><span class="o">.</span><span class="n">block</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;add IP address for red server&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/hosts&quot;</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;10.0.0.1 mars-one</span><span class="se">\n</span><span class="s2">10.0.0.2 mars-two&quot;</span><span class="p">,</span>
    <span class="n">before</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;.*localhost&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># remove marked entry from /etc/hosts</span>
<span class="n">files</span><span class="o">.</span><span class="n">block</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;remove all 10.* addresses from /etc/hosts&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/hosts&quot;</span><span class="p">,</span>
    <span class="n">present</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># add out of date warning to web page</span>
<span class="n">files</span><span class="o">.</span><span class="n">block</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;add out of date warning to web page&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/var/www/html/something.html&quot;</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span> <span class="s2">&quot;&lt;p&gt;Warning: this page is out of date.&lt;/p&gt;&quot;</span><span class="p">,</span>
    <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;.*&lt;body&gt;.*&quot;</span><span class="p">,</span>
    <span class="n">after</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&lt;!-- </span><span class="si">{mark}</span><span class="s2"> PYINFRA BLOCK --&gt;&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># put complex alias into .zshrc</span>
<span class="n">files</span><span class="o">.</span><span class="n">block</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/home/user/.zshrc&quot;</span><span class="p">,</span>
    <span class="n">content</span><span class="o">=</span><span class="s2">&quot;eval $(thefuck -a)&quot;</span><span class="p">,</span>
    <span class="n">try_prevent_shell_expansion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;## </span><span class="si">{mark}</span><span class="s2"> ALIASES ##&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-directory">
<span id="operations-files-directory"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.directory</span></code><a class="headerlink" href="#files-directory" title="Link to this heading">¶</a></h2>
<p>Add/remove/update directories.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">directory</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">force_backup_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>path</strong>: path of the remote folder</p></li>
<li><p><strong>present</strong>: whether the folder should exist</p></li>
<li><p><strong>user</strong>: user to own the folder</p></li>
<li><p><strong>group</strong>: group to own the folder</p></li>
<li><p><strong>mode</strong>: permissions of the folder</p></li>
<li><p><strong>recursive</strong>: recursively apply user/group/mode</p></li>
<li><p><strong>force</strong>: if the target exists and is not a file, move or remove it and continue</p></li>
<li><p><strong>force_backup</strong>: set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to remove any existing non-file when <code class="docutils literal notranslate"><span class="pre">force=True</span></code></p></li>
<li><p><strong>force_backup_dir</strong>: directory to move any backup to when <code class="docutils literal notranslate"><span class="pre">force=True</span></code></p></li>
</ul>
<p><strong>Examples:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">directory</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ensure the /tmp/dir_that_we_want_removed is removed&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/tmp/dir_that_we_want_removed&quot;</span><span class="p">,</span>
    <span class="n">present</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">files</span><span class="o">.</span><span class="n">directory</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ensure /web exists&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/web&quot;</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="s2">&quot;myweb&quot;</span><span class="p">,</span>
    <span class="n">group</span><span class="o">=</span><span class="s2">&quot;myweb&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Multiple directories</span>
<span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;/netboot/tftp&quot;</span><span class="p">,</span> <span class="s2">&quot;/netboot/nfs&quot;</span><span class="p">]:</span>
    <span class="n">files</span><span class="o">.</span><span class="n">directory</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ensure the directory `</span><span class="si">{}</span><span class="s2">` exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">dir</span><span class="p">),</span>
        <span class="n">path</span><span class="o">=</span><span class="nb">dir</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-download">
<span id="operations-files-download"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.download</span></code><a class="headerlink" href="#files-download" title="Link to this heading">¶</a></h2>
<p>Download files from remote locations using <code class="docutils literal notranslate"><span class="pre">curl</span></code> or <code class="docutils literal notranslate"><span class="pre">wget</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
    <span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cache_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sha384sum</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sha256sum</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sha1sum</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">md5sum</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">insecure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">proxy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">temp_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_curl_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">extra_wget_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>src</strong>: source URL of the file</p></li>
<li><p><strong>dest</strong>: where to save the file</p></li>
<li><p><strong>user</strong>: user to own the files</p></li>
<li><p><strong>group</strong>: group to own the files</p></li>
<li><p><strong>mode</strong>: permissions of the files</p></li>
<li><p><strong>cache_time</strong>: if the file exists already, re-download after this time (in seconds)</p></li>
<li><p><strong>force</strong>: always download the file, even if it already exists</p></li>
<li><p><strong>sha384sum</strong>: sha384 hash to checksum the downloaded file against</p></li>
<li><p><strong>sha256sum</strong>: sha256 hash to checksum the downloaded file against</p></li>
<li><p><strong>sha1sum</strong>: sha1 hash to checksum the downloaded file against</p></li>
<li><p><strong>md5sum</strong>: md5 hash to checksum the downloaded file against</p></li>
<li><p><strong>headers</strong>: optional dictionary of headers to set for the HTTP request</p></li>
<li><p><strong>insecure</strong>: disable SSL verification for the HTTP request</p></li>
<li><p><strong>proxy</strong>: simple HTTP proxy through which we can download files, form <cite>http://&lt;yourproxy&gt;:&lt;port&gt;</cite></p></li>
<li><p><strong>temp_dir</strong>: use this custom temporary directory during the download</p></li>
<li><p><strong>extra_curl_args</strong>: optional dictionary with custom arguments for curl</p></li>
<li><p><strong>extra_wget_args</strong>: optional dictionary with custom arguments for wget</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Download the Docker repo file&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://download.docker.com/linux/centos/docker-ce.repo&quot;</span><span class="p">,</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/etc/yum.repos.d/docker-ce.repo&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-file">
<span id="operations-files-file"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.file</span></code><a class="headerlink" href="#files-file" title="Link to this heading">¶</a></h2>
<p>Add/remove/update files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">file</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">touch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create_remote_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">force_backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_backup_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>path</strong>: name/path of the remote file</p></li>
<li><p><strong>present</strong>: whether the file should exist</p></li>
<li><p><strong>user</strong>: user to own the files</p></li>
<li><p><strong>group</strong>: group to own the files</p></li>
<li><p><strong>mode</strong>: permissions of the files as an integer, eg: 755</p></li>
<li><p><strong>touch</strong>: whether to touch the file</p></li>
<li><p><strong>create_remote_dir</strong>: create the remote directory if it doesn’t exist</p></li>
<li><p><strong>force</strong>: if the target exists and is not a file, move or remove it and continue</p></li>
<li><p><strong>force_backup</strong>: set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to remove any existing non-file when <code class="docutils literal notranslate"><span class="pre">force=True</span></code></p></li>
<li><p><strong>force_backup_dir</strong>: directory to move any backup to when <code class="docutils literal notranslate"><span class="pre">force=True</span></code></p></li>
</ul>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">create_remote_dir</span></code>:</dt><dd><p>If the remote directory does not exist it will be created using the same
user &amp; group as passed to <code class="docutils literal notranslate"><span class="pre">files.put</span></code>. The mode will <em>not</em> be copied over,
if this is required call <code class="docutils literal notranslate"><span class="pre">files.directory</span></code> separately.</p>
</dd>
</dl>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note: The directory /tmp/secret will get created with the default umask.</span>
<span class="n">files</span><span class="o">.</span><span class="n">file</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Create /tmp/secret/file&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/tmp/secret/file&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;600&quot;</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="n">group</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="n">touch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">create_remote_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-flags">
<span id="operations-files-flags"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.flags</span></code><a class="headerlink" href="#files-flags" title="Link to this heading">¶</a></h2>
<p>Set/clear file flags.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">flags</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>path</strong>: path of the remote folder</p></li>
<li><p><strong>flags</strong>: a list of the file flags to be set or cleared</p></li>
<li><p><strong>present</strong>: whether the flags should be set or cleared</p></li>
</ul>
<p><strong>Examples:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">flags</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ensure ~/Library is visible in the GUI&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;~/Library&quot;</span><span class="p">,</span>
    <span class="n">flags</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span><span class="p">,</span>
    <span class="n">present</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">files</span><span class="o">.</span><span class="n">directory</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ensure no one can change these files&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/something/very/important&quot;</span><span class="p">,</span>
    <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uchg&quot;</span><span class="p">,</span> <span class="s2">&quot;schg&quot;</span><span class="p">],</span>
    <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">_sudo</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-get">
<span id="operations-files-get"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.get</span></code><a class="headerlink" href="#files-get" title="Link to this heading">¶</a></h2>
<div class="important admonition">
<p class="admonition-title">Stateless operation</p>
<p>This operation will always execute commands and is not idempotent.</p>
</div>
<p>Download a file from the remote system.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">add_deploy_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_local_dir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>src</strong>: the remote filename to download</p></li>
<li><p><strong>dest</strong>: the local filename to download the file to</p></li>
<li><p><strong>add_deploy_dir</strong>: dest is relative to the deploy directory</p></li>
<li><p><strong>create_local_dir</strong>: create the local directory if it doesn’t exist</p></li>
<li><p><strong>force</strong>: always download the file, even if the local copy matches</p></li>
</ul>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation is not suitable for large files as it may involve copying
the remote file before downloading it.</p>
</dd>
</dl>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Download a file from a remote&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="s2">&quot;/etc/centos-release&quot;</span><span class="p">,</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/tmp/whocares&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-line">
<span id="operations-files-line"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.line</span></code><a class="headerlink" href="#files-line" title="Link to this heading">¶</a></h2>
<p>Ensure lines in files using grep to locate and sed to replace.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">replace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">flags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interpolate_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">escape_regex_characters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ensure_newline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>path</strong>: target remote file to edit</p></li>
<li><p><strong>line</strong>: string or regex matching the target line</p></li>
<li><p><strong>present</strong>: whether the line should be in the file</p></li>
<li><p><strong>replace</strong>: text to replace entire matching lines when <code class="docutils literal notranslate"><span class="pre">present=True</span></code></p></li>
<li><p><strong>flags</strong>: list of flags to pass to sed when replacing/deleting</p></li>
<li><p><strong>backup</strong>: whether to backup the file (see below)</p></li>
<li><p><strong>interpolate_variables</strong>: whether to interpolate variables in <code class="docutils literal notranslate"><span class="pre">replace</span></code></p></li>
<li><p><strong>escape_regex_characters</strong>: whether to escape regex characters from the matching line</p></li>
<li><p><strong>ensure_newline</strong>: ensures that the appended line is on a new line</p></li>
</ul>
<dl class="simple">
<dt>Regex line matching:</dt><dd><p>Unless line matches a line (starts with ^, ends $), pyinfra will wrap it such that
it does, like: <code class="docutils literal notranslate"><span class="pre">^.*LINE.*$</span></code>. This means we don’t swap parts of lines out. To
change bits of lines, see <code class="docutils literal notranslate"><span class="pre">files.replace</span></code>.</p>
</dd>
<dt>Regex line escaping:</dt><dd><p>If matching special characters (eg a crontab line containing <code class="docutils literal notranslate"><span class="pre">*</span></code>), remember to escape
it first using Python’s <code class="docutils literal notranslate"><span class="pre">re.escape</span></code>.</p>
</dd>
<dt>Backup:</dt><dd><p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, any editing of the file will place an old copy with the ISO
date (taken from the machine running <code class="docutils literal notranslate"><span class="pre">pyinfra</span></code>) appended as the extension. If
you pass a string value this will be used as the extension of the backed up file.</p>
</dd>
<dt>Append:</dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">line</span></code> is not in the file but we want it (<code class="docutils literal notranslate"><span class="pre">present</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code>), then
it will be append to the end of the file.</p>
</dd>
<dt>Ensure new line:</dt><dd><p>This will ensure that the <code class="docutils literal notranslate"><span class="pre">line</span></code> being appended is always on a separate new
line in case the file doesn’t end with a newline character.</p>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare to do some maintenance</span>
<span class="n">maintenance_line</span> <span class="o">=</span> <span class="s2">&quot;SYSTEM IS DOWN FOR MAINTENANCE&quot;</span>
<span class="n">files</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Add the down-for-maintenance line in /etc/motd&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/motd&quot;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="n">maintenance_line</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Then, after the maintenance is done, remove the maintenance line</span>
<span class="n">files</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Remove the down-for-maintenance line in /etc/motd&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/motd&quot;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="n">maintenance_line</span><span class="p">,</span>
    <span class="n">replace</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">present</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># example where there is &#39;*&#39; in the line</span>
<span class="n">files</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ensure /netboot/nfs is in /etc/exports&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/exports&quot;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;/netboot/nfs .*&quot;</span><span class="p">,</span>
    <span class="n">replace</span><span class="o">=</span><span class="s2">&quot;/netboot/nfs *(ro,sync,no_wdelay,insecure_locks,no_root_squash,&quot;</span>
    <span class="s2">&quot;insecure,no_subtree_check)&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">files</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ensure myweb can run /usr/bin/python3 without password&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/sudoers&quot;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;myweb .*&quot;</span><span class="p">,</span>
    <span class="n">replace</span><span class="o">=</span><span class="s2">&quot;myweb ALL=(ALL) NOPASSWD: /usr/bin/python3&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># example when there are double quotes (&quot;)</span>
<span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;QUOTAUSER=&quot;&quot;&#39;</span>
<span class="n">files</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Example with double quotes (&quot;</span><span class="p">)</span><span class="s2">&quot;,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/adduser.conf&quot;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="s2">&quot;^</span><span class="si">{}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">),</span>
    <span class="n">replace</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-link">
<span id="operations-files-link"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.link</span></code><a class="headerlink" href="#files-link" title="Link to this heading">¶</a></h2>
<p>Add/remove/update links.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">link</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">present</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_remote_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">force_backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_backup_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>path</strong>: the name of the link</p></li>
<li><p><strong>target</strong>: the file/directory the link points to</p></li>
<li><p><strong>present</strong>: whether the link should exist</p></li>
<li><p><strong>user</strong>: user to own the link</p></li>
<li><p><strong>group</strong>: group to own the link</p></li>
<li><p><strong>symbolic</strong>: whether to make a symbolic link (vs hard link)</p></li>
<li><p><strong>create_remote_dir</strong>: create the remote directory if it doesn’t exist</p></li>
<li><p><strong>force</strong>: if the target exists and is not a file, move or remove it and continue</p></li>
<li><p><strong>force_backup</strong>: set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to remove any existing non-file when <code class="docutils literal notranslate"><span class="pre">force=True</span></code></p></li>
<li><p><strong>force_backup_dir</strong>: directory to move any backup to when <code class="docutils literal notranslate"><span class="pre">force=True</span></code></p></li>
</ul>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">create_remote_dir</span></code>:</dt><dd><p>If the remote directory does not exist it will be created using the same
user &amp; group as passed to <code class="docutils literal notranslate"><span class="pre">files.put</span></code>. The mode will <em>not</em> be copied over,
if this is required call <code class="docutils literal notranslate"><span class="pre">files.directory</span></code> separately.</p>
</dd>
<dt>Source changes:</dt><dd><p>If the link exists and points to a different target, pyinfra will remove it and
recreate a new one pointing to then new target.</p>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">link</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Create link /etc/issue2 that points to /etc/issue&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/issue2&quot;</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="s2">&quot;/etc/issue&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-move">
<span id="operations-files-move"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.move</span></code><a class="headerlink" href="#files-move" title="Link to this heading">¶</a></h2>
<p>Move remote file/directory/link into remote directory</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>src</strong>: remote file/directory to move</p></li>
<li><p><strong>dest</strong>: remote directory to move <cite>src</cite> into</p></li>
<li><p><strong>overwrite</strong>: whether to overwrite dest, if present</p></li>
</ul>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-put">
<span id="operations-files-put"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.put</span></code><a class="headerlink" href="#files-put" title="Link to this heading">¶</a></h2>
<p>Upload a local file, or file-like object, to the remote system.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
    <span class="n">src</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">IO</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_deploy_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_remote_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">assume_exists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">atime</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mtime</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>src</strong>: filename or IO-like object to upload</p></li>
<li><p><strong>dest</strong>: remote filename to upload to</p></li>
<li><p><strong>user</strong>: user to own the files</p></li>
<li><p><strong>group</strong>: group to own the files</p></li>
<li><p><strong>mode</strong>: permissions of the files, use <code class="docutils literal notranslate"><span class="pre">True</span></code> to copy the local file</p></li>
<li><p><strong>add_deploy_dir</strong>: src is relative to the deploy directory</p></li>
<li><p><strong>create_remote_dir</strong>: create the remote directory if it doesn’t exist</p></li>
<li><p><strong>force</strong>: always upload the file, even if the remote copy matches</p></li>
<li><p><strong>assume_exists</strong>: whether to assume the local file exists</p></li>
<li><p><strong>atime</strong>: value of atime the file should have, use <code class="docutils literal notranslate"><span class="pre">True</span></code> to match the local file</p></li>
<li><p><strong>mtime</strong>: value of mtime the file should have, use <code class="docutils literal notranslate"><span class="pre">True</span></code> to match the local file</p></li>
</ul>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">dest</span></code>:</dt><dd><p>If this is a directory that already exists on the remote side, the local
file will be uploaded to that directory with the same filename.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code>:</dt><dd><p>When set to <code class="docutils literal notranslate"><span class="pre">True</span></code> the permissions of the local file are applied to the
remote file after the upload is complete.  If set to an octal value with
digits for at least user, group, and other, either as an <code class="docutils literal notranslate"><span class="pre">int</span></code> or
<code class="docutils literal notranslate"><span class="pre">str</span></code>, those permissions will be used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">create_remote_dir</span></code>:</dt><dd><p>If the remote directory does not exist it will be created using the same
user &amp; group as passed to <code class="docutils literal notranslate"><span class="pre">files.put</span></code>. The mode will <em>not</em> be copied over,
if this is required call <code class="docutils literal notranslate"><span class="pre">files.directory</span></code> separately.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">atime</span></code> and <code class="docutils literal notranslate"><span class="pre">mtime</span></code>:</dt><dd><p>When set to values other than <code class="docutils literal notranslate"><span class="pre">False</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code>, the respective metadata
fields on the remote file will updated accordingly.  Timestamp values are
considered equivalent if the difference is less than one second and they have
the identical number in the seconds field.  If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> the local
file is the source of the value.  Otherwise, these values can be provided as
<code class="docutils literal notranslate"><span class="pre">datetime</span></code> objects, POSIX timestamps, or strings that can be parsed into
either of these date and time specifications.  They can also be reference file
paths on the remote host, as with the <code class="docutils literal notranslate"><span class="pre">-r</span></code> argument to <code class="docutils literal notranslate"><span class="pre">touch</span></code>.  If a
<code class="docutils literal notranslate"><span class="pre">datetime</span></code> argument has no <code class="docutils literal notranslate"><span class="pre">tzinfo</span></code> value (i.e., it is naive), it is
assumed to be in the remote host’s local timezone.  There is no shortcut for
setting both <code class="docutils literal notranslate"><span class="pre">atime`</span> <span class="pre">and</span> <span class="pre">``mtime</span></code> values with a single time specification,
unlike the native <code class="docutils literal notranslate"><span class="pre">touch</span></code> command.</p>
</dd>
<dt>Notes:</dt><dd><p>This operation is not suitable for large files as it may involve copying
the file before uploading it.</p>
<p>Currently, if the mode argument is anything other than a <code class="docutils literal notranslate"><span class="pre">bool</span></code> or a full
octal permission set and the remote file exists, the operation will always
behave as if the remote file does not match the specified permissions and
requires a change.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">atime</span></code> argument is set for a given file, unless the remote
filesystem is mounted <code class="docutils literal notranslate"><span class="pre">noatime</span></code> or <code class="docutils literal notranslate"><span class="pre">relatime</span></code>, multiple runs of this
operation will trigger the change detection for that file, since the act of
reading and checksumming the file will cause the host OS to update the file’s
<code class="docutils literal notranslate"><span class="pre">atime</span></code>.</p>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Update the message of the day file&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="s2">&quot;files/motd&quot;</span><span class="p">,</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/etc/motd&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;644&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">files</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Upload a StringIO object&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;file contents&quot;</span><span class="p">),</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/etc/motd&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-replace">
<span id="operations-files-replace"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.replace</span></code><a class="headerlink" href="#files-replace" title="Link to this heading">¶</a></h2>
<p>Replace contents of a file using <code class="docutils literal notranslate"><span class="pre">sed</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">backup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interpolate_variables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>path</strong>: target remote file to edit</p></li>
<li><p><strong>text</strong>: text/regex to match against</p></li>
<li><p><strong>replace</strong>: text to replace with</p></li>
<li><p><strong>flags</strong>: list of flags to pass to sed</p></li>
<li><p><strong>backup</strong>: whether to backup the file (see below)</p></li>
<li><p><strong>interpolate_variables</strong>: whether to interpolate variables in <code class="docutils literal notranslate"><span class="pre">replace</span></code></p></li>
</ul>
<dl class="simple">
<dt>Backup:</dt><dd><p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, any editing of the file will place an old copy with the ISO
date (taken from the machine running <code class="docutils literal notranslate"><span class="pre">pyinfra</span></code>) appended as the extension. If
you pass a string value this will be used as the extension of the backed up file.</p>
</dd>
</dl>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Change part of a line in a file&quot;</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/etc/motd&quot;</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;verboten&quot;</span><span class="p">,</span>
    <span class="n">replace</span><span class="o">=</span><span class="s2">&quot;forbidden&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-rsync">
<span id="operations-files-rsync"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.rsync</span></code><a class="headerlink" href="#files-rsync" title="Link to this heading">¶</a></h2>
<div class="important admonition">
<p class="admonition-title">Stateless operation</p>
<p>This operation will always execute commands and is not idempotent.</p>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">rsync</span></code> to sync a local directory to the remote system. This operation will actually call
the <code class="docutils literal notranslate"><span class="pre">rsync</span></code> binary on your system.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">rsync</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">files.rsync</span></code> operation is in alpha, and only supported using SSH
or <code class="docutils literal notranslate"><span class="pre">&#64;local</span></code> connectors. When using the SSH connector, rsync will automatically use the
StrictHostKeyChecking setting, config and known_hosts file (when specified).</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>When using SSH, the <code class="docutils literal notranslate"><span class="pre">files.rsync</span></code> operation only supports the <code class="docutils literal notranslate"><span class="pre">sudo</span></code> and <code class="docutils literal notranslate"><span class="pre">sudo_user</span></code>
global arguments.</p>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-sync">
<span id="operations-files-sync"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.sync</span></code><a class="headerlink" href="#files-sync" title="Link to this heading">¶</a></h2>
<p>Syncs a local directory with a remote one, with delete support. Note that delete will
remove extra files on the remote side, but not extra directories.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span>
    <span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dir_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_deploy_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>src</strong>: local directory to sync</p></li>
<li><p><strong>dest</strong>: remote directory to sync to</p></li>
<li><p><strong>user</strong>: user to own the files and directories</p></li>
<li><p><strong>group</strong>: group to own the files and directories</p></li>
<li><p><strong>mode</strong>: permissions of the files</p></li>
<li><p><strong>dir_mode</strong>: permissions of the directories</p></li>
<li><p><strong>delete</strong>: delete remote files not present locally</p></li>
<li><p><strong>exclude</strong>: string or list/tuple of strings to match &amp; exclude files (eg <code class="docutils literal notranslate"><span class="pre">*.pyc</span></code>)</p></li>
<li><p><strong>exclude_dir</strong>: string or list/tuple of strings to match &amp; exclude directories (eg node_modules)</p></li>
<li><p><strong>add_deploy_dir</strong>: interpret src as relative to deploy directory instead of current directory</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sync local files/tempdir to remote /tmp/tempdir</span>
<span class="n">files</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sync a local directory with remote&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="s2">&quot;files/tempdir&quot;</span><span class="p">,</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/tmp/tempdir&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">exclude</span></code> and <code class="docutils literal notranslate"><span class="pre">exclude_dir</span></code> use <code class="docutils literal notranslate"><span class="pre">fnmatch</span></code> behind the scenes to do the filtering.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exclude</span></code> matches against the filename.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exclude_dir</span></code> matches against the path of the directory, relative to <code class="docutils literal notranslate"><span class="pre">src</span></code>.
Since fnmatch does not treat path separators (<code class="docutils literal notranslate"><span class="pre">/</span></code> or <code class="docutils literal notranslate"><span class="pre">\</span></code>) as special characters,
excluding all directories matching a given name, however deep under <code class="docutils literal notranslate"><span class="pre">src</span></code> they are,
can be done for example with <code class="docutils literal notranslate"><span class="pre">exclude_dir=[&quot;__pycache__&quot;,</span> <span class="pre">&quot;*/__pycache__&quot;]</span></code></p></li>
</ul>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
<section id="files-template">
<span id="operations-files-template"></span><h2><code class="code docutils literal notranslate"><span class="pre">files.template</span></code><a class="headerlink" href="#files-template" title="Link to this heading">¶</a></h2>
<p>Generate a template using jinja2 and write it to the remote system.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
    <span class="n">src</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">IO</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_remote_dir</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">jinja_env_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>src</strong>: template filename or IO-like object</p></li>
<li><p><strong>dest</strong>: remote filename</p></li>
<li><p><strong>user</strong>: user to own the files</p></li>
<li><p><strong>group</strong>: group to own the files</p></li>
<li><p><strong>mode</strong>: permissions of the files</p></li>
<li><p><strong>create_remote_dir</strong>: create the remote directory if it doesn’t exist</p></li>
<li><p><strong>jinja_env_kwargs</strong>: keyword arguments to be passed into the jinja Environment()</p></li>
</ul>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">create_remote_dir</span></code>:</dt><dd><p>If the remote directory does not exist it will be created using the same
user &amp; group as passed to <code class="docutils literal notranslate"><span class="pre">files.put</span></code>. The mode will <em>not</em> be copied over,
if this is required call <code class="docutils literal notranslate"><span class="pre">files.directory</span></code> separately.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">jinja_env_kwargs</span></code>:</dt><dd><p>To have more control over how jinja2 renders your template, you can pass
a dict with arguments that will be passed as keyword args to the jinja2
<a class="reference external" href="https://jinja.palletsprojects.com/en/3.0.x/api/#jinja2.Environment">Environment()</a>.</p>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">host</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code>, and <code class="docutils literal notranslate"><span class="pre">inventory</span></code> objects will be automatically passed to the template
if not set explicitly.</p>
<dl>
<dt>Notes:</dt><dd><p>Common convention is to store templates in a “templates” directory and
have a filename suffix with ‘.j2’ (for jinja2).</p>
<p>For information on the template syntax, see
<a class="reference external" href="https://jinja.palletsprojects.com">the jinja2 docs</a>.</p>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Create a templated file&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="s2">&quot;templates/somefile.conf.j2&quot;</span><span class="p">,</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/etc/somefile.conf&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">files</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Create service file&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="s2">&quot;templates/myweb.service.j2&quot;</span><span class="p">,</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/etc/systemd/system/myweb.service&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;755&quot;</span><span class="p">,</span>
    <span class="n">user</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="p">,</span>
    <span class="n">group</span><span class="o">=</span><span class="s2">&quot;root&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Example showing how to pass python variable to template file. You can also</span>
<span class="c1"># use dicts and lists. The .j2 file can use `{{ foo_variable }}` to be interpolated.</span>
<span class="n">foo_variable</span> <span class="o">=</span> <span class="s1">&#39;This is some foo variable contents&#39;</span>
<span class="n">foo_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;str1&quot;</span><span class="p">:</span> <span class="s2">&quot;This is string 1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;str2&quot;</span><span class="p">:</span> <span class="s2">&quot;This is string 2&quot;</span>
<span class="p">}</span>
<span class="n">foo_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;entry 1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;entry 2&quot;</span>
<span class="p">]</span>

<span class="n">template</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">name: &quot;{{ foo_variable }}&quot;</span>
<span class="s2">dict_contents:</span>
<span class="s2">    str1: &quot;{{ foo_dict.str1 }}&quot;</span>
<span class="s2">    str2: &quot;{{ foo_dict.str2 }}&quot;</span>
<span class="s2">list_contents:</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or entry in foo_list %}</span>
<span class="s2">    - &quot;{{ entry }}&quot;</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">files</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Create a templated file&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/tmp/foo.yml&quot;</span><span class="p">,</span>
    <span class="n">foo_variable</span><span class="o">=</span><span class="n">foo_variable</span><span class="p">,</span>
    <span class="n">foo_dict</span><span class="o">=</span><span class="n">foo_dict</span><span class="p">,</span>
    <span class="n">foo_list</span><span class="o">=</span><span class="n">foo_list</span>
<span class="p">)</span>

<span class="c1"># Example showing how to use host and inventory in a template file.</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">name: &quot;{{ host.name }}&quot;</span>
<span class="s2">list_contents:</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or entry in inventory.groups.my_servers %}</span>
<span class="s2">    - &quot;{{ entry }}&quot;</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">files</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Create a templated file&quot;</span><span class="p">,</span>
    <span class="n">src</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;/tmp/foo.yml&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>Note:</dt><dd><p>This operation also inherits all <a class="reference internal" href="../arguments.html"><span class="doc">global arguments</span></a>.</p>
</dd>
</dl>
</section>
</section>


        </div>
          
  <nav class="footer-relations">
    <ul class="pager">
      
        <li class="previous"><a href="docker.html">
          <span aria-hidden="true">&larr;</span> Docker Operations
        </a></li>
      
        <li class="next"><a href="flatpak.html">
          Flatpak Operations <span aria-hidden="true">&rarr;</span>
        </a></li>
      
    </ul>
  </nav>
    <div class="clearer"></div>
  
      </div>
      <div class="clearfix"></div>
  </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="flatpak.html" title="Flatpak Operations"
             >next</a> |</li>
        <li class="right" >
          <a href="docker.html" title="Docker Operations"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Home</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../operations.html" >Operations Index</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Files Operations</a></li> 
      </ul>
    </div>
<script type="text/javascript" src="../_static/js/jquery.min.js"></script>
<script type="text/javascript" src="../_static/js/bootstrap.min.js"></script>
<script type="text/javascript">
  $("a#toggle-menu").click(function () {
    $("#left-column").slideToggle(100);
  });

  var currentIndexItem = document.querySelector('ul.current ul.current li.current');
  if (currentIndexItem) {
    currentIndexItem.scrollIntoView({'block': 'center'});
  }
</script>
  <div class="footer">
  </div>


  <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
  <script type="text/javascript">
    docsearch({
        apiKey: '25a25b5f5310f306641f9ce07dcb06eb',
        appId: 'XXGX6EX4KA',
        indexName: 'pyinfra',
        container: '#docsearch',
        searchParameters: {
          facetFilters: ["version:latest", "lang:en"],
        },
        debug: false,
    });
  </script>



  
    <script async defer data-domain="docs.pyinfra.com" src="https://stats.oxygem.com/js/index.js"></script>
  

  </body>
</html>